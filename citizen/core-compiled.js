/* checkboxHack.js */
!function(e,t){"use strict";let n=".p-menu-checkbox-container";function i(e=t){if(e.classList&&e.classList.contains(n))return c(e);let i=e.querySelectorAll(n);i.forEach(e=>{c(e)})}function c(t){let n=t.querySelector(".p-menu-checkbox"),i=t.querySelector(".p-menu-checkbox-button"),c=t.querySelector(".p-menu-checkbox-target");n&&i&&c&&s(e,n,i,c)}function o(e,t){if(t){t.setAttribute("aria-expanded",e.checked.toString());return}e.setAttribute("aria-expanded",e.checked.toString())}function r(e,n){e.checked=n;let i;if("function"==typeof Event)i=new Event("input",{bubbles:!0,composed:!0});else{if(!(i=t.createEvent("CustomEvent")))return;i.initCustomEvent("input",!0,!1,!1)}e.dispatchEvent(i)}function u(e,n,i,c){let o=c.target instanceof Node&&(e.contains(c.target)||n.contains(c.target)||i.contains(c.target));if(e.checked&&!o){e.checked=!1;let r;if("function"==typeof Event)r=new Event("input",{bubbles:!0,composed:!0});else{let u=t.createEvent("CustomEvent");if(!u)return;u.initCustomEvent("input",!0,!1,!1)}e.dispatchEvent(r)}}function s(e,t,n,i){let c=[function e(t,n){let i=o.bind(void 0,t,void 0);return t.addEventListener("input",i),function(){t.removeEventListener("input",i)}}(t),function e(t,n){function i(e){e.preventDefault(),r(t,!t.checked)}return n.addEventListener("click",i,!0),function(){n.removeEventListener("click",i,!0)}}(t,n),function e(t){function n(e){"Enter"===e.key&&r(t,!t.checked)}return t.addEventListener("keyup",n),function(){t.removeEventListener("keyup",n)}}(t),function e(t,n,i,c){let o=u.bind(void 0,n,i,c);return t.addEventListener("click",o,!0),function(){t.removeEventListener("click",o,!0)}}(e,t,n,i),function e(t,n,i,c){let o=u.bind(void 0,n,i,c);return t.addEventListener("focusin",o,!0),function(){t.removeEventListener("focusin",o,!0)}}(e,t,n,i),function e(t,n){function i(e){("A"===e.target.nodeName||"A"===e.target.parentNode.nodeName)&&r(t,!1)}return n.addEventListener("click",i),function(){n.removeEventListener("click",i)}}(t,i),function e(t,n){let i=e=>{"Escape"===e.key&&r(n,!1)};return t.addEventListener("keyup",i,!0),function(){t.removeEventListener("keyup",i)}}(e,t)];return function(){c.forEach(function(e){e()})}}TypechoCore.utils.checkboxHack=i,TypechoCore.utils.bindCheckbox=s,i()}(window,document);
/* citizenCore.js */
!function(e,t,n){let a=new URL(n.currentScript.src),r=a.origin,s=TypechoCore.getRelativePath(),i=r+s;TypechoCore.state("citizenRoot",i),TypechoCore.utils.bindKey(function(){n.getElementById("p-search--checkbox").click()},e=>{let t=n.activeElement.tagName;return!["INPUT","DIV","TEXTAREA","SELECT"].includes(t)&&191===e.which},!0),TypechoCore.Element.loaderIndicator=function(e){let t=e.data("icon")??"switcher";e.css("background-image","url(https://registry.npmmirror.com/typecho-core/latest/files/citizen/spinners/"+t+".svg)"),t.endsWith("no_animation")&&e.css("animation","none"),TypechoCore.xhr.listen(()=>{e.fadeOut(300)}),TypechoCore.xhr.listen(()=>{e.fadeIn(100)},!1,"send")},TypechoCore.Element.themeSwitch=function(a){if(!function e(n){let a;try{a=t[n];let r="__storage_test__";return a.setItem(r,r),a.removeItem(r),!0}catch(s){return s instanceof DOMException&&(22===s.code||1014===s.code||"QuotaExceededError"===s.name||"NS_ERROR_DOM_QUOTA_REACHED"===s.name)&&a&&0!==a.length}}("localStorage"))return console.warn("LocalStorage 不可用，明暗切换功能将会失效。");let r=e("html");a.click(function(){e(n).trigger("citizen:themeSwitched"),r.toggleClass("skin-dark");let t=e("html").hasClass("skin-dark");localStorage.setItem("citizenTheme",t?"dark":"light")})},TypechoCore.Element.animateIn=function(e){e.data("initialized",!1);let t=e.data("class-in")??"u-smoothIn",n=e.data("class-out")??"u-smoothOut",a=e.data("animation-ready");if(e.data("fade-up")){a?e.children(".p-body-container").children(".p-grid, .p-body-header, .p-content, .p-section, .p-body-footer, .p-comment").addClass("u-fadeUp"):r();return}function r(t){e.addClass(t).data("animation-ready",!0)}let s;function i(){clearTimeout(s)}TypechoCore.proxy(TypechoCore.State,"loadedFrom",a=>{switch(a){default:e.data("animation-ready",!1);break;case"xhrClick":r(n);break;case"popstate":r(t+" reverse")}}),a&&(e.hasClass("reverse")&&([t,n]=[n,t]),e.classTo(n,t),s=setTimeout(function(){e.removeClass(t).removeClass("reverse")},200),TypechoCore.xhr.listenOnce(i,"click"),TypechoCore.xhr.listenOnce(i,"popstate"))},TypechoCore.Element.contentArea=function(t){let n=TypechoCore,a=n.Element;n.content.registerArea();let r=e(TypechoCore.content.html),s=i+"icons/loading.svg";r.find("img").each(function(){let t=e(this);if(!t.attr("alt")||"A"===t.parent().prop("nodeName"))return!0;let n=t.attr("src");t.attr("src",s).attr("data-src",n).addClass("lazy"),t.wrap('<a href="'+n+'" data-lightbox></a>')}),t.html(r),t.find("h2, h3").each(function(){let t=e(this).text();e(this).attr("id",t)}),n.utils.lazyLoad(n.content.areaId,"img"),a.toc(t),a.fancybox(t),a.prismJS(t)},TypechoCore.Element.fancybox=async function(t){await TypechoCore.engine.requestResource(["https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-y/fancybox/3.5.7/jquery.fancybox.min.js","https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-y/fancybox/3.5.7/jquery.fancybox.min.css"]),void 0!==e.fancybox&&(this.fancyOptions||(this.fancyOptions={loop:!0,buttons:["slideShow","fullScreen","thumbs","download","zoom","close"],transitionEffect:"slide",thumbs:{axis:"x"},lang:"zh",i18n:{zh:{CLOSE:"关闭",NEXT:"下一个",PREV:"上一个",ERROR:"内容加载失败。",PLAY_START:"播放幻灯片",PLAY_STOP:"暂停幻灯片",FULL_SCREEN:"全屏",THUMBS:"缩略图",DOWNLOAD:"下载",ZOOM:"缩放"}}}),t.find("[data-lightbox]").each(function(){let t=e(this).parent();e(this).attr({"data-fancybox":"articleBody","data-caption":t.find("figcaption").text()}),e(this).fancybox(TypechoCore.Element.fancyOptions)}))},TypechoCore.Element.carousel=async function(e){await TypechoCore.engine.requestResource(["https://registry.npmmirror.com/@fancyapps/ui/latest/files/dist/carousel/carousel.umd.js","https://registry.npmmirror.com/@fancyapps/ui/latest/files/dist/carousel/carousel.thumbs.umd.js","https://registry.npmmirror.com/@fancyapps/ui/latest/files/dist/carousel/carousel.css","https://registry.npmmirror.com/@fancyapps/ui/latest/files/dist/carousel/carousel.thumbs.css",]),new Carousel(e[0],{l10n:"zh_CN",Thumbs:{type:"modern"}},{Thumbs})},TypechoCore.Element.prismJS=function(e){let t=e[0].getElementsByTagName("pre");0!==t.length&&TypechoCore.engine.requestResource([i+"prism/prism.min.js",i+"prism/prism.min.css",]).then(function(){if("undefined"!=typeof Prism){for(let e=0;e<t.length;e++)t[e].getElementsByTagName("code").length>0&&(t[e].className="line-numbers");Prism.highlightAll(!1,null)}})},TypechoCore.Element.toc=async function(a){let r=n.getElementById("toc");if(!r||0===r.length)return;if(0===a.find("h2").length)return r.remove();await TypechoCore.engine.requestResource(["https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-y/tocbot/4.18.2/tocbot.min.js","https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-y/tocbot/4.18.2/tocbot.min.css"]);let s=t.tocbot;s.init({headingSelector:"h2",activeLinkClass:"is-active",tocSelector:".toc-target",contentSelector:".p-content",ignoreSelector:".js-toc-ignore",hasInnerContainers:!0,scrollSmooth:!0,scrollSmoothDuration:40,headingsOffset:20,scrollSmoothOffset:-20,includeTitleTags:!0});try{TypechoCore.utils.checkboxHack(r)}catch(i){console.warn("未提供 checkboxHack 实现，目录按钮将不会工作。")}TypechoCore.xhr.listenOnce(function(){s.destroy(),e(t).off("scroll")})},TypechoCore.Element.fabulous=function(e){let t=e[0],a="fab_record",r=TypechoCore,s=Number(r.content.id);if(!r.content.permalink){console.warn("TypechoCore 的 content.permalink 成员属性接口未生效。","只有在提供了 permalink 属性的页面中，Fabulous 功能才能够正常工作。"),e.attr("title","此操作当前不可用。浏览控制台以进一步了解信息。").css("cursor","not-allowed");return}if(r.storage.localStorageArrayExists(a,s))return e.addClass("animation liked confetti noEffect");let i=["#7d32f5","#f6e434","#63fdf1","#e672da","#295dfe","#6e57ff"],o=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),c=e=>{let t=n.createElement("i");t.style.setProperty("--x",o(-260,260)+"px"),t.style.setProperty("--y",o(-160,160)+"px"),t.style.setProperty("--r",o(0,360)+"deg"),t.style.setProperty("--s",o(.6,1)),t.style.setProperty("--b",i[o(0,5)]),e.appendChild(t)};e.on("click",function(e){let n=t.children[1].textContent;function i(){t.classList.remove("animation","liked","confetti"),t.children[1].textContent=parseInt(n)-1}if(t.classList.contains("animation"))i();else{t.classList.add("animation");for(let o=0;o<60;o++)c(t);if(setTimeout(()=>{t.classList.add("confetti"),setTimeout(()=>{t.classList.add("liked"),t.children[1].textContent=parseInt(n)+1},400),setTimeout(()=>{t.querySelectorAll("i").forEach(e=>e.remove())},600)},260),r.storage.localStorageArrayExists(a,s))return e.preventDefault();r.xhr.makeRequest({url:r.content.permalink+"/increaseField",type:"POST",success(e){r.storage.localStorageArray("fab_record",e.cid)},error(e,t,n){i(),r.ui.flashMessage("操作未能完成，可能是由于网络或服务器错误所导致。"),console.error("Fabulous 请求发生错误。",e,t,n)}})}e.preventDefault()})},TypechoCore.registerElement("animate-in"),TypechoCore.registerElement("theme-switch"),TypechoCore.registerElement("loader-indicator"),TypechoCore.registerElement("content-area"),TypechoCore.registerElement("fabulous")}(window.jQuery,window,document);
/* tapTop.js */
!function(t,e,n){"use strict";let o=null,l=!1,s=!1,i=!1,r=e.pageYOffset||n.documentElement.scrollTop,u=null,c=null,a,f=null,$=n.querySelector(".progress-wrap path"),d=$?$.getTotalLength():0;function h(t){if(l)return;let i=e.pageYOffset||n.documentElement.scrollTop,f=r;if(r=i,i>f)"down"!==u&&(u="down",c=f);else{if(!(i<f))return;"up"!==u&&(u="up",c=f)}if(s){if("up"!==u||r<100){a&&(a.cancel(),a=null);return}if(c-i<30)return}a||(a=function t(n,o){o||(o=0);let l=e.requestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)},s=Date.now(),i={};function r(){Date.now()-s>=o?n():i.id=l(r)}return i.id=l(r),i.cancel=function(){(e.cancelAnimationFrame||e.clearTimeout)(this.id)},i}(function(){a=null,r<10?p():(m(),y(),o=setTimeout(function(){p()},3e3))},50))}function m(){i||(f.removeClass("hidden"),f.addClass("active-progress"),i=!0)}function p(){i&&(f.addClass("hidden"),f.removeClass("active-progress"),i=!1)}function g(){let o=t(e).scrollTop(),l=t(n).height()-t(e).height();$.style.strokeDashoffset=d-o*d/l}function y(){clearTimeout(o)}f&&f.length||!(f=t(".js-scrollButtons")).length||("up"===f.data("trigger-type")&&(s=!0),f.on({"mouseenter focus":function t(){r>0&&(y(),m())},"mouseleave blur":function t(){y()},click:function t(e){l=!0,setTimeout(function(){l=!1},500),p(),jQuery("html, body").animate({scrollTop:0},80)}}),d&&($.style.transition=$.style.WebkitTransition="none",$.style.strokeDasharray=d+" "+d,$.style.strokeDashoffset=d,$.getBoundingClientRect(),$.style.transition=$.style.WebkitTransition="stroke-dashoffset 10ms linear",g(),t(e).scroll(g)),t(e).scroll(h)),TypechoCore.xhr.listen(function(){t(e).scroll(g),t(e).scroll(h)}),TypechoCore.xhr.listen(p,!1,"click")}(window.jQuery,window,document);
/* musicPlayer.js */
let CitizenPlayer=window.CitizenPlayer||{};(CitizenPlayer={musicList:[],musicCurrent:null,apiEndpoint:"",mainContainer:$(".p-player"),albumContainer:$(".p-player--album"),infoContainer:$(".p-player--info"),eventInitialized:!1,sound:null,pointer:0,random:!1,mute:!1,loop:!1,init:function(t=""){if(void 0===window.Howl)return console.warn("由于未引入 Howler，播放器现已中止加载。");if(0===this.mainContainer.length)return console.warn("找不到播放器容器。");let i=""===t?this.mainContainer.data("playlist"):t;if(i){let n=this.mainContainer.data("endpoint");if(!n||""===n)return console.warn("未提供 API 终结点。播放器将不会工作。");this.ui.init(this),this.apiEndpoint=n,this.processPlaylist(i)}else console.warn("未声明歌单 ID。")},playerInit:function(t){this.musicList=t,this.musicCurrent=t[0],this.ui.initComponents(),this.bindFunctions({playPause:"actionPlay",songNext:"playNext",songPrevious:"playPrevious",songShuffle:"actionShuffle",songRepeat:"actionLoop"})},processPlaylist:function(t){fetch(this.apiEndpoint+t).then(t=>t.json()).then(t=>{t[0]&&""!==t[0].name?this.playerInit(t):console.warn("歌单中不存在音乐，请检查所提供的歌单。")})},play:function(t){this.musicCurrent=this.musicList[t],this.musicCurrent&&(this.sound&&this.sound.stop(),this.sound=new window.Howl({src:this.musicCurrent.url,format:["mp3"],preload:!0,autoplay:!1,loop:this.loop,onload:this.ui.controlOnLoad,onplay:this.ui.control__IconToPause,onpause:this.ui.control__IconToPlaying,onstop:this.ui.control__IconToPlaying,onend:function(){CitizenPlayer.ui.controlOnLoading(),CitizenPlayer.playNext(1,!0),setTimeout(CitizenPlayer.ui.indicateOnEnd,1500)}}),this.ui.initComponents(),this.ui.initVisualizer(),"loading"===this.sound.state()&&this.ui.controlOnLoading(),this.sound.play())},ui:{_player:null,controlIcon:null,controlButton:null,shuffleButton:null,repeatButton:null,canvasContainer:null,init:function(t){this._player=t,this.controlButton=$(document.getElementById("playPause")),this.controlIcon=this.controlButton.children("span"),this.shuffleButton=$(document.getElementById("songShuffle")),this.repeatButton=$(document.getElementById("songRepeat")),this.canvasContainer=document.getElementById("playerVisualizer")},initComponents:function(){this.get("info h1").text(this._player.musicCurrent.name),this.get("info h2").text(this._player.musicCurrent.artist),this.get("album img").attr("src",this._player.musicCurrent.pic)},initVisualizer:function(){if(!this.canvasContainer)return;let t=window.Howler.ctx,i=this.canvasContainer.getContext("2d"),n=null;n=t.createAnalyser();let e=this._player.sound._sounds[0]._node;e.connect(n),n.fftSize=128;let o=n.frequencyBinCount,s=new Uint8Array(o),a=this.canvasContainer.width/o,l=0,r=({bufferLength:t,dataArray:n,barWidth:e})=>{let o;for(let s=0;s<t;s++){o=.75*n[s+10];let a=s*o/10,r=5*s,u=o/4-16;i.fillStyle=`rgb(${a}, ${r}, ${u})`,i.fillRect(l,CitizenPlayer.ui.canvasContainer.height-o,e,o),l+=e}};!function t(){l=0,i.clearRect(0,0,CitizenPlayer.ui.canvasContainer.width,CitizenPlayer.ui.canvasContainer.height),n.getByteFrequencyData(s),r({bufferLength:o,dataArray:s,barWidth:a}),requestAnimationFrame(t)}()},get:function(t){return $(".p-player--"+t)},indicateOnEnd:function(){$(".player-indicator img").attr("src",CitizenPlayer.musicCurrent.pic),$(".player-indicator").fadeIn("fast",function(){$(this).delay(1e3).fadeOut("fast")})},control__IconToPause:function(){CitizenPlayer.ui.controlIcon.html("pause")},control__IconToPlaying:function(){CitizenPlayer.ui.controlIcon.html("play_arrow")},switchShuffle:function(){this.shuffleButton.toggleClass("is-active"),this.repeatButton.removeClass("is-active")},switchRepeat:function(){this.repeatButton.toggleClass("is-active"),this.shuffleButton.removeClass("is-active")},controlOnLoading:function(){CitizenPlayer.ui.controlButton.addClass("is-loading")},controlOnLoad:function(){CitizenPlayer.ui.controlButton.removeClass("is-loading")}},playNext:function(t=1,i=!1){if(i&&this.loop)return!0;this.random?this.pointer=Math.floor(Math.random()*(this.musicList.length-1)):(this.pointer+=t,this.pointer<0?this.pointer=this.musicList.length-1:this.pointer===this.musicList.length&&(this.pointer=0)),this.play(this.pointer)},playPrevious:function(){this.playNext(-1)},actionPlay:function(){this.sound?this.sound.playing()?this.sound.pause():this.sound.play():this.play(this.pointer)},actionShuffle:function(){this.loop=!1,this.random=!this.random,this.ui.switchShuffle()},actionLoop:function(){this.random=!1,this.loop=!this.loop,this.ui.switchRepeat()},bindFunctions:function(t){this.eventInitialized||($.each(t,function(t,i){$("#"+t).click(function(){"function"==typeof CitizenPlayer[i]&&CitizenPlayer[i]()})}),this.eventInitialized=!0)}}).init();