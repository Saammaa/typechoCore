function gReExpired(){TypechoCore.Element.gCaptchaCallback(!1)}function gReSuccess(){TypechoCore.Element.gCaptchaCallback(!0)}!function(t,e,n,i){let s=TypechoCore.state("citizenRoot"),a=[s+"discussion/commentEditor.js",],o="https://registry.npmmirror.com/typecho-core/latest/files/carol/carolExtends.min.js";TypechoCore.Element.discussion=function(e){let n=t("[data-comment-title]"),i=t("[data-comment-form]"),s=t("[data-comment-submit]"),a=n.text(),o=t("<input>").attr("type","hidden").attr("name","parent"),c=t("<button>取消回复</button>").addClass("p-button p-button--destructive").on("click",function(){n.text(a),o.remove(),t(this).detach()});e.find("[data-comment-reply]").on("click",function(){TypechoCore.utils.scrollTo(e);let a=t(this).data("comment-reply"),r=t(this).closest(".comment-item"),l=r.attr("id"),m=l.lastIndexOf("-"),d=l.substring(m+1,l.length);o.val(d).appendTo(i),n.text("@"+a+"："),c.detach(),s.before(c)})},TypechoCore.Element.discussionCaptcha=async function(n){let i=t(".g-recaptcha").html(""),s=TypechoCore.engine.isResolved("api.js");await TypechoCore.engine.requestResource("https://recaptcha.net/recaptcha/api.js"),s&&e.grecaptcha.render(i[0]),TypechoCore.ui.switchable(n,i),TypechoCore.xhr.listenOnce(function(){t(".g-recaptcha-bubble-arrow").parent().remove()},"click")},TypechoCore.Callback.discussionCallback=function(e,i){if(!e||!e.success)return TypechoCore.Element.gCaptchaCallback(!1);let s=e.parentId,a="comment-list",o=n.getElementById("comments"),c="DESC"===o.getAttribute("data-order"),r=e.content;o.querySelector("textarea").value="";let l=TypechoCore.State.commentEditorInstance;l&&l.setData("");let m=o.querySelector("."+a);m?s?(o=n.getElementById("comment-"+s),c=!1):o=m:(r='<ol class="'+a+'">'+r+"</ol>",c=!1);let d=c?0:1,u=TypechoCore.ui.setupHtmlInsert(t(o),r,d,!0,"comment-new");TypechoCore.utils.lazyLoad(u,"img"),u.find("[data-comment-reply] > *").css("pointer-events","none"),u.find("[data-comment-reply]").attr("title","你刚刚发布这条评论。在重新加载此页面之前，你还不能对它本身进行回复。").css("cursor","not-allowed")},TypechoCore.Element.gCaptchaCallback=function(e,n){let i=t(".comment-captcha"),s=t(".g-recaptcha"),a="p-button--",o=a+"interactive",c=a+"destructive",r="reCAPTCHA 已通过，评论所在表单将验证为有效。";e?(i.addClass(o).removeClass(c),s.addClass("u-hidden")):(i.addClass(c).removeClass(o),r="reCAPTCHA 未通过。请验证。",n&&TypechoCore.ui.flashMessage(r)),i.attr("title",r)},TypechoCore.Element.commentEditor=function(e){TypechoCore.engine.requestResource(TypechoCore.state("citizenRoot")+"css/editor.css").then();let i=n.getElementById(e.data("editor")),s=i.closest(".editor-container"),c=e.data("version"),r=!!i.getAttribute("data-external-smiley"),l=t('<span class="editor-inspector is-loading">正在加载评论编辑器。</span>');function m(e,n,i,s){TypechoCore.State.commentEditorInstance=e;let a=t(e.ui.view.toolbar.element);TypechoCore.ui.setupHtmlInsert(t(i),a,-1),s.removeClassTransitioned("is-loading",function(){s.remove()}),e.model.document.on("change:data",()=>{e.sourceElement.innerText=e.getData()}),n.remove()}if(TypechoCore.State.commentEditorInstance&&(l=t("")),TypechoCore.isElementRegistered("instant-editor")||TypechoCore.isElementRegistered("classic-editor"))return TypechoCore.Element.commentEditorCarol(e,i,s,c,r,l,m);e.on("click",function(){t(this).html('<div class="loading"></div>处理中').off("click"),l.appendTo(s),"undefined"==typeof Carol&&(Carol={editorOptions:{},extendEditorOptions:function(t,e){this.editorOptions[t]=e}}),r||(o="/common/themes/citizen/assets/discussion/smiley-compiled.js?v="+c);let n=a.concat(o);TypechoCore.engine.requestResource(n).then(t=>{CommentEditor.create(i,Carol.editorOptions).then(t=>{m(t,e,i,l)})})})},TypechoCore.registerElement("discussion"),TypechoCore.registerElement("discussion-captcha"),TypechoCore.registerElement("comment-editor")}(jQuery,window,document);