let Carol=window.Carol||{};Carol={editor:[],editorOptions:{},editorArea:null,editTrigger:null,securityToken:null,contentId:null,codeMirrorThemeConfig:[],init:function(e,t,i){this.setEditorArea(e),this.editorArea&&CarolEditor&&this.editorInit(t,i)},setEditorArea:function(e){this.editorArea=e},setEditorOptions:function(e){this.editorOptions=e},setSecurityToken:function(e){this.securityToken=e},setContentId:function(e){this.contentId=e},getCurrentEditor:function(){return this.editor.slice(-1)[0]},setCodeMirrorThemeConfig:function(e){this.codeMirrorThemeConfig=Object.keys(e).map(t=>({[t]:e[t]}))},extendEditorOptions:function(e,t){this.editorOptions[e]=t},editorInit:function(e,t){let i;i=Object.assign({link:{addTargetToExternalLinks:!0},codeMirror:{themeConfig:this.codeMirrorThemeConfig},style:{definitions:[{name:"圈住",element:"span",classes:["boxed"]},{name:"文艺青年",element:"blockquote",classes:["well-quote"]},{name:"黑幕",element:"span",classes:["spoiler"]},]},codeBlock:{languages:[{language:"plaintext",label:"纯文本"},{language:"js",label:"JavaScript"},{language:"css",label:"CSS"},{language:"html",label:"HTML"},{language:"php",label:"PHP"},{language:"json",label:"JSON"},{language:"cpp",label:"C++"},{language:"java",label:"Java"},{language:"apacheconf",label:"Apache 配置"},{language:"bash",label:"Bash"},{language:"sql",label:"SQL"},]},htmlSupport:{allow:[{name:/.*/,attributes:!0,classes:!0,styles:!0}]},mediaEmbed:{previewsInData:!0,providers:[{name:"BiliBili",url:/^bilibili\.com\/video\/(\w+)/,html:e=>`<iframe src="//player.bilibili.com/player.html?bvid=${e[1]}&danmaku=0&autoplay=0" width="100%" height="500"></iframe>`},]},wordCount:{displayWords:!1},placeholder:"这里是您的编辑区域。将光标聚焦至此处以开始创作。",updateSourceElementOnDestroy:!0},this.editorOptions,t),CarolEditor.create(this.editorArea,i).then(t=>{this.editor.push(t),"function"==typeof e&&e(t);let i=t.sourceElement;"TEXTAREA"===i.tagName&&this.syncStatusChanges(i),this.editorOptions={}}).catch(e=>{console.error("Carol 编辑器出现错误。",e)})},syncStatusChanges:function(e){let t=this.getCurrentEditor();t.model.document.on("change:data",()=>{e.value=t.getData()})},commitAction:function(e=!0,t){if(!e||!this.editor||0===this.editor.length)return TypechoCore.engine.instantRedirect();let i=this.securityToken;TypechoCore.xhr.makeRequest({url:"/action/contents-post-edit",type:"POST",data:{do:"fastPublish",_:i,cid:this.contentId,text:t},success(e){TypechoCore.engine.handleServerResponse(e)},error:function(e,t,i){console.error("XHR 发生错误。",e,t,i),TypechoCore.ui.flashMessage("快速保存遇到错误，详见控制台信息。请先保存你的内容，然后刷新页面重试。")}})},destroy:function(){Carol.editor&&Carol.editor.length>0&&(Carol.editor.forEach(function(e){e.ui.view.toolbar.element.remove(),e.ui.view.editable.element.remove();let t=document.querySelectorAll(".instant-editor");t.forEach(function(e){e.classList.remove("instant-editor")}),e.destroy()}),Carol.editor=[])}};